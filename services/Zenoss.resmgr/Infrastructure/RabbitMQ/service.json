{
    "CPUCommitment": 1,
    "Command": "/bin/supervisord -n -c /etc/rabbitmq/rabbit_supervisor.conf",
    "ConfigFiles": {
        "/etc/rabbitmq/rabbit_supervisor.conf": {
            "FileName": "/etc/rabbitmq/rabbit_supervisor.conf",
            "Owner": "root:root",
            "Permissions": "0664"
        },
        "/etc/rabbitmq/rabbitmq-env.conf": {
            "FileName": "/etc/rabbitmq/rabbitmq-env.conf",
            "Owner": "root:root",
            "Permissions": "0664"
        },
        "/etc/rabbitmq/rabbitmq.config": {
            "FileName": "/etc/rabbitmq/rabbitmq.config",
            "Owner": "root:root",
            "Permissions": "0664"
        },
        "/opt/zenoss/etc/global.conf": {
            "Content": "# Generated by serviced\n{{range $k,$v:=contextFilter . \"global.conf.\"}}{{$k}} {{$v}}\n{{end}}",
            "Filename": "/opt/zenoss/etc/global.conf",
            "Owner": "zenoss:zenoss",
            "Permissions": "660"
        }
    },
    "Description": "RabbitMQ server",
    "EmergencyShutdownLevel": 2,
    "Endpoints": [
        {
            "Application": "rabbitmq_admin",
            "Name": "rabbitmq admin",
            "PortNumber": 15672,
            "Protocol": "tcp",
            "Purpose": "export",
            "Vhosts": [
                "rabbitmq"
            ]
        },
        {
            "Application": "rabbitmq",
            "Name": "rabbitmq",
            "PortNumber": 5672,
            "Protocol": "tcp",
            "Purpose": "export"
        },
        {
            "Application": "rabbitmq_epmd",
            "Name": "rabbitmq_epmd",
            "PortNumber": 4369,
            "Protocol": "tcp",
            "Purpose": "export"
        },
        {
            "Application": "rabbitmq_inet_dist",
            "Name": "rabbitmq_inet_dist",
            "PortNumber": 44001,
            "Protocol": "tcp",
            "Purpose": "export"
        },
        {
            "Application": "rabbitmq_epmd",
            "Name": "rabbitmq_epmds",
            "PortNumber": 4369,
            "PortTemplate": "{{plus .InstanceID 14369}}",
            "Protocol": "tcp",
            "Purpose": "import_all",
            "VirtualAddress": "rbt{{.InstanceID}}:4369"
        },
        {
            "Application": "rabbitmq_inet_dist",
            "Name": "rabbitmq_inet_dists",
            "PortNumber": 44001,
            "PortTemplate": "{{plus .InstanceID 49001}}",
            "Protocol": "tcp",
            "Purpose": "import_all",
            "VirtualAddress": "rbt{{.InstanceID}}:44001"
        },
        {
            "Application": "rabbitmq",
            "Name": "rabbitmqs",
            "PortNumber": 5672,
            "PortTemplate": "{{plus .InstanceID 35672}}",
            "Protocol": "tcp",
            "Purpose": "import_all",
            "VirtualAddress": "rbt{{.InstanceID}}:5672"
        }
    ],
    "HealthChecks": {
        "admin": {
            "Interval": 10.0,
            "Script": "curl -A 'RabbitMQ admin healthcheck' -s -u {{(getContext . \"global.conf.amqpuser\")}}:{{(getContext . \"global.conf.amqppassword\")}} http://localhost:15672/api/vhosts | grep -q /zenoss"
        },
        "publishing": {
            "Interval": 10.0,
            "Script": "curl -A 'RabbitMQ publishing healthcheck' -s -u {{(getContext . \"global.conf.amqpuser\")}}:{{(getContext . \"global.conf.amqppassword\")}} http://localhost:15672/api/aliveness-test/%2Fzenoss | grep -q '{\"status\":\"ok\"}'"
        },
        "user": {
            "Interval": 15.0,
            "Script": "/opt/zenoss/bin/healthchecks/RabbitMQ/user {{(getContext . \"global.conf.amqpuser\")}} {{(getContext . \"global.conf.amqppassword\")}}"
        }
    },
    "Hostname": "rbt{{.InstanceID}}",
    "ImageID": "zenoss/zenoss5x",
    "Instances": {
        "max": 1,
        "min": 1
    },
    "Launch": "auto",
    "LogConfigs": [
        {
            "filters": [
                "rabbitmq"
            ],
            "path": "/var/log/rabbitmq/rabbit@rbt[0-9]*.log",
            "type": "rabbitmq"
        },
        {
            "filters": [
                "rabbitmq"
            ],
            "path": "/var/log/rabbitmq/rabbit@rbt[0-9]*-sasl.log",
            "type": "rabbitmq_sasl"
        }
    ],
    "Name": "RabbitMQ",
    "Prereqs": [
        {
            "Name": "Cluster Leader Start",
            "Script": "[ $(hostname) == 'rbt0' ] || rabbitmqctl -n rabbit@rbt0 status | grep nodedown || sleep 5"
        }
    ],
    "Privileged": true,
    "RAMCommitment": "256M",
    "Services": [],
    "Snapshot": {
        "Pause": "PAUSE_CHECK_TIMEOUT=60 ${ZENHOME:-/opt/zenoss}/bin/quiesce-rabbitmq.sh pause",
        "Resume": "${ZENHOME:-/opt/zenoss}/bin/quiesce-rabbitmq.sh resume"
    },
    "StartLevel": 1,
    "Tags": [
        "daemon"
    ],
    "Volumes": [
        {
            "#####": "drwxr-x--- 4 rabbitmq rabbitmq 4096 Feb 25 21:25 /var/lib/rabbitmq",
            "ContainerPath": "/var/lib/rabbitmq",
            "Owner": "rabbitmq:rabbitmq",
            "Permission": "0750",
            "ResourcePath": "rabbitmq/{{.InstanceID}}"
        }
    ]
}
